<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<title>Time Zone World Map</title>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="topojson.v1.min.js"></script>
</head>
<body>
<script>
  var width = 1000;
  var height = 600;

  var projection = d3.geo.mercator();
                   // .translate([width/2, height/2])
                    //.scale([500]);

  var path = d3.geo.path().projection(projection);

  var color = d3.scale.quantize()
                .range(["rgb(237,248,233)","rgb(186,228,179)","rgb(116,196,118)","rgb(49,163,84)","rgb(0,109,44)"]);

  var svg = d3.select("body").append("svg")
                          .attr("width",width)
                          .attr("height",height);

  d3.json('data/scm-timezone.json', function(data){
    //console.log(data.commits);
    color.domain([
      d3.min(data, function() { return parseInt(data.commits); }),
      d3.max(data, function() { return parseInt(data.commits); })
      ]);

  d3.json("world.json", function(json){
    for(var i = 0;i < data.tz.length;i++){
      var dataTZ = parseInt(data.tz[i]);
      //console.log(typeof dataTZ);
      var commitValue = parseInt(data.commits[i]);
      for(var j = 0;j<json.features.length;j++){
        //console.log(json.features.length);
        var jsonTZ = parseInt(json.features[j].properties.description);
       // console.log(typeof jsonTZ);
        if(dataTZ == jsonTZ) {
          json.features[j].properties.value = commitValue;
          break;
        }
      }
    }

    svg.selectAll("path")
        .data(json.features)
        .enter()
        .append("path")
        .attr("d",path)
        .style("fill", function(d){
          var val = d.properties.value;
          if(val){ return color(val); }
          else { return "#ccc"; }
                });
            });
         });

    </script>
  </body>
</html>